<!DOCTYPE html>
<html>
<head>
  <title>Vibration Example</title>
</head>
<body onload="availabilityMessage()">

<button onclick="playGame()">Vibrate Phone v0.7</button>

<script>

function patternForOneBuzz(){
	let pattern = [];
	startGap = 20; 
	for (let currentGap= -startGap; currentGap < Math.abs(startGap); currentGap++) {
			pattern.push(5); //buzz
			pattern.push(Math.abs(currentGap)); //break
	}
	return pattern;
}


function availabilityMessage(){
	if (navigator.vibrate) {
		// Vibrate for 1000 milliseconds (1 second)
		alert('Vibration IS supported in this browser.');
	} else {
		alert('Vibration NOT supported in this browser.');
	}
}
	
const vibratePhone = async (howManyTimes) =>{
  // Check if the browser supports the Vibration API
  console.log("about to start vibrating");

	if (navigator.vibrate) {
		let pattern = [];
		for (let i=0; i < howManyTimes; i++) {
			pattern.push(...patternForOneBuzz());
		}
		console.log("about to start");
		console.log(pattern);
		navigator.vibrate(pattern);
		var sumMilliseconds = pattern.reduce((accumulator, currentValue) => {
			return accumulator + currentValue
		},0);
		setTimeout(finishGame, sumMilliseconds);
	}
}
function getRandomInt(min, max) {
  min = Math.ceil(min);
  max = Math.floor(max);
  return Math.floor(Math.random() * (max - min + 1)) + min;
}
let randomNumOfVibrations = 1;

async function playGame(){
	randomNumOfVibrations = getRandomInt(2, 5);
	alert("count the vibrarions!");
    vibratePhone(randomNumOfVibrations);
}

async function finishGame(){
	let answer = prompt('how many did you count?');
	if (Number.isInteger(parseInt(answer, 10))){
		let message = `you guessed ${answer}, and there were ${randomNumOfVibrations}.`
		message += randomNumOfVibrations===parseInt(answer)? " CONGRATS!" : "OH NO!"
		alert(message);
	}else{
		alert(`${answer} does not look like a number`);
	}
  

	
}

</script>

</body>
</html>